{"version":3,"sources":["watcher.min.js"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","id","loaded","call","m","c","p","utils","Watcher","$w","watcher","init","config","reportUrl","Error","watcherInit","console","log","window","undefined","_isReportUrl","url","indexOf","_config","_notNullObject","obj","_typeof","_isEmptyObject","name","_JSONStringifySafty","JSON","stringify","e","warn","_JSONParseSafty","str","val","parse","err","_listenXhrResponse","xhr","requestUrl","_http","setTimeout","readyState","DONE","_errorReport","type","message","addEventListener","res","response","status","code","status_code","detail","_post","options","XMLHttpRequest","onload","this","callback","open","withCredentials","setRequestHeader","send","data","_handleError","evt","error","filename","stack","lineno","colno","env","appCodeName","navigator","appName","platform","appVersion","ua","userAgent","_watchXhrError","xhrProto","prototype","_open","method","apply","slice","arguments","_send","_watchWinError","_watcherInit","Symbol","iterator","constructor","watchWinError","watchXhrError","_decodeSourceMap","sourceMap","mappings","uglyLineArr","split","map","line","keywordArr","keyword","decode","fixedMap","getAbsoultePosition","sourceFileIndex","sourceCodeLine","sourceCodeColumn","nameIndex","generatedCodeColumn","absoluteKeyword","push","_fixPosDetail","col","names","sources","lineMap","keywordMap","some","sourceFile","sourceName","decodeSourceMap","fixPosDetail"],"mappings":"CAAS,SAAUA,GAKT,QAASC,GAAoBC,GAG5B,GAAGC,EAAiBD,GACnB,MAAOC,GAAiBD,GAAUE,OAGnC,IAAIC,GAASF,EAAiBD,IAC7BE,WACAE,GAAIJ,EACJK,QAAQ,EAUT,OANAP,GAAQE,GAAUM,KAAKH,EAAOD,QAASC,EAAQA,EAAOD,QAASH,GAG/DI,EAAOE,QAAS,EAGTF,EAAOD,QAvBf,GAAID,KAqCJ,OATAF,GAAoBQ,EAAIT,EAGxBC,EAAoBS,EAAIP,EAGxBF,EAAoBU,EAAI,GAGjBV,EAAoB,KAK/B,SAAUI,EAAQD,EAASH,GAGhC,GAAIW,GAAQX,EAAoB,GAE5BY,EAAU,WACZ,GAAIC,GACAC,IAeJ,OAbAA,GAAQC,KAAO,SAAUC,GACvB,IAAKA,EAAOC,UACV,KAAM,IAAIC,OAAM,sBAElBP,GAAMQ,YAAYH,IAGpBH,EAAK,SAAYG,GACf,MAAOF,GAAQC,KAAKC,IAEtBH,EAAGE,KAAO,WACRK,QAAQC,IAAI,QAEPR,IAGTS,QAAOV,QAAUA,EACHW,SAAdD,OAAOT,KAAqBS,OAAOT,GAAKD,IAInC,SAAUR,EAAQD,EAASH,GAOhC,QAASwB,GAAaC,GACpB,MAAOA,GAAIC,QAAQC,EAAQV,YAAc,EAG3C,QAASW,GAAeC,GACtB,MAAkE,YAA9C,mBAARA,GAAsB,YAAcC,EAAQD,KAC5C,OAARA,EAIN,QAASE,GAAeF,GACtB,GAAIG,EACJ,KAAKA,IAAQH,GACX,OAAO,CACR,QAAO,EAGV,QAASI,GAAoBJ,GAC3B,IAAKD,EAAeC,GAAM,MAAO,EACjC,IAAIE,EAAeF,GAAM,MAAO,EAChC,KACE,MAAOK,MAAKC,UAAUN,GACtB,MAAOO,GAEP,MADAhB,SAAQiB,KAAK,4CACN,IAIX,QAASC,GAAgBC,GACvB,IACE,GAAIC,GAAMN,KAAKO,MAAMF,EACrB,OAAkE,YAA9C,mBAARC,GAAsB,YAAcV,EAAQU,KAA8B,OAARA,EACrEA,KAIT,MAAOE,GAEP,MADAtB,SAAQiB,KAAK,6CAKjB,QAASM,GAAmBC,GAC1B,GAAIC,GAAaD,EAAIE,MAAMrB,GAC3BsB,YAAW,WACLH,EAAII,aAAeJ,EAAIK,MACzBC,GACEC,KAAM,UACN1B,IAAKoB,EACLO,QAAS,mBAGZ,KAEHR,EAAIS,iBAAiB,OAAQ,WAC3B,GAAIC,KACAV,GAAIW,WACND,EAAMhB,EAAgBM,EAAIW,WAGxBD,GAAOA,EAAIE,QAA8B,IAApBF,EAAIE,OAAOC,MAAwC,GAA1BH,EAAIE,OAAOE,aAC3DR,GACEC,KAAM,UACN1B,IAAKoB,EACLO,QAAS,oBACTO,QACEH,OAAQvB,EAAoBqB,EAAIE,aAMxCZ,EAAIS,iBAAiB,QAAS,SAAUjB,GACtCc,GACEC,KAAM,UACN1B,IAAKoB,EACLO,QAAS,qBAGbR,EAAIS,iBAAiB,QAAS,WAC5BH,GACEC,KAAM,UACN1B,IAAKoB,EACLO,QAAS,qBAGbR,EAAIS,iBAAiB,UAAW,WAC9BH,GACEC,KAAM,UACN1B,IAAKoB,EACLO,QAAS,uBAcf,QAASQ,GAAMC,GACb,GAAIjB,GAAM,GAAIkB,eACdlB,GAAImB,OAAS,WACX,GAAIC,KAAKR,QAAU,KAAOQ,KAAKR,OAAS,KAAqB,KAAdZ,EAAIY,OACjD,IACEK,EAAQI,UAAYJ,EAAQI,SAAS3B,EAAgB0B,KAAKT,WAC1D,MAAOnB,MAGbQ,EAAIsB,KAAK,OAAQL,EAAQpC,KAAK,GAC9BmB,EAAIuB,iBAAkB,EACtBvB,EAAIwB,iBAAiB,eAAgB,qCACrCxB,EAAIwB,iBAAiB,SAAU,qCAC/BxB,EAAIyB,KAAKpC,EAAoB4B,EAAQS,OAGvC,QAASC,GAAaC,GACpB,GAAIC,GAAQD,EAAIC,KAChB,OAAKA,IAKHrB,QAASqB,EAAMrB,QACf3B,IAAK+C,EAAIE,SACTvB,KAAM,mBACNQ,QACEgB,MAAOF,EAAME,MACbC,OAAQJ,EAAII,OACZC,MAAOL,EAAIK,SAVbzD,QAAQiB,KAAK,gEACN,MAcX,QAASa,GAAauB,GACpBA,EAAMK,KACJC,YAAaC,UAAUD,YACvBE,QAASD,UAAUC,QACnBC,SAAUF,UAAUE,SACpBC,WAAYH,UAAUG,WACtBC,GAAIJ,UAAUK,WAEhBzB,GACEnC,IAAKE,EAAQV,UACbqD,KAAMG,IAIV,QAASa,KACP,GAAIC,GAAWzB,eAAe0B,SAC9BD,GAASE,MAAQF,EAASrB,KAC1BqB,EAASrB,KAAO,SAAUwB,EAAQjE,GAIhC,MAHAuC,MAAKlB,MAAQkB,KAAKlB,UAClBkB,KAAKlB,MAAM4C,OAASA,EACpB1B,KAAKlB,MAAMrB,IAAMA,EACV8D,EAASE,MAAME,MAAM3B,QAAS4B,MAAMrF,KAAKsF,aAElDN,EAASO,MAAQP,EAASlB,KAC1BkB,EAASlB,KAAO,WACd,GAAIzB,GAAMoB,IAIV,OAHKxC,GAAaoB,EAAIE,MAAMrB,MAC1BkB,EAAmBC,GAEd2C,EAASO,MAAMH,MAAM3B,QAAS4B,MAAMrF,KAAKsF,aAIpD,QAASE,KACPzE,OAAO+B,iBAAiB,QAAS,SAAUmB,GACzC,GAIIC,IAJOD,EAAII,OACLJ,EAAIK,MACFL,EAAIC,MAAME,MAEVJ,EAAaC,GACrBC,IACFvB,EAAauB,KAKnB,QAASuB,GAAahF,GACpBW,EAAUX,EACV+E,IACAT,IAhMF,GAGI3D,GAHAG,EAA4B,kBAAXmE,SAAoD,gBAApBA,QAAOC,SAAwB,SAAUrE,GAAO,aAAcA,IAAS,SAAUA,GAAO,MAAOA,IAAyB,kBAAXoE,SAAyBpE,EAAIsE,cAAgBF,QAAUpE,IAAQoE,OAAOT,UAAY,eAAkB3D,GAE5P7B,GAAoB,EAiM9BI,GAAOD,SACLgB,YAAa6E,EACbI,cAAeL,EACfM,cAAef,IAKZ,SAAUlF,EAAQD,GAIvB,QAASmG,GAAiBC,GACxB,GAAIC,GAAWD,EAAUC,SAErBC,EAAcD,EAASE,MAAM,IAajC,OAZAD,GAAcA,EAAYE,IAAI,SAAUC,GACtC,GAAIC,GAAaD,EAAKF,MAAM,IAC5B,OAAOG,KAETJ,EAAcA,EAAYE,IAAI,SAAUE,GACtC,MAAOA,GAAWF,IAAI,SAAUG,GAC9B,MAAOC,QAAOD,OAIlBE,SAAWC,EAAoBR,GAExBO,SAGT,QAASC,GAAoBR,GAC3B,GAAIS,GAAkB,EAClBC,EAAiB,EACjBC,EAAmB,EACnBC,EAAY,EAEZL,EAAWP,EAAYE,IAAI,SAAUE,GACvC,GAAIS,GAAsB,CAE1B,OAAOT,GAAWF,IAAI,SAAUG,GAC9B,GAAIS,KAeJ,OAdAD,IAAuBR,EAAQ,GAC/BS,EAAgBC,KAAKF,GAErBJ,GAAmBJ,EAAQ,GAC3BK,GAAkBL,EAAQ,GAC1BM,GAAoBN,EAAQ,GAE5BS,EAAgBC,KAAKN,EAAiBC,EAAgBC,GAEnC7F,SAAfuF,EAAQ,KACVO,GAAaP,EAAQ,GACrBS,EAAgBC,KAAKH,IAGhBE,KAIX,OAAOP,GAGT,QAASS,GAAcb,EAAMc,EAAKf,EAAKgB,EAAOC,GAC5C,GAEIC,GAAUlB,EAAIC,EAAO,GACrBkB,EAAa,MACjBD,GAAQE,KAAK,SAAUjB,GACrB,MAAIA,GAAQ,KAAOY,EAAM,IACvBI,EAAahB,GACN,IAKX,IAAIK,GAAiBW,EAAW,GAAK,EACjCV,EAAmBU,EAAW,GAAK,EACnCE,EAAaJ,EAAQE,EAAW,IAEhCG,EAAa,EAKjB,OAJsB1G,UAAlBuG,EAAW,KACbG,EAAaN,EAAMG,EAAW,MAI9BX,eAAgBA,EAChBC,iBAAkBA,EAClBY,WAAYA,EACZC,WAAYA,GAIhB7H,EAAOD,SACL+H,gBAAiB5B,EACjB6B,aAAcV","file":"watcher.min.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n\n\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t\n\tvar utils = __webpack_require__(1);\n\n\tvar Watcher = function () {\n\t  var $w,\n\t      watcher = {};\n\n\t  watcher.init = function (config) {\n\t    if (!config.reportUrl) {\n\t      throw new Error('reportUrl is needed');\n\t    }\n\t    utils.watcherInit(config);\n\t  };\n\n\t  $w = function $w(config) {\n\t    return watcher.init(config);\n\t  };\n\t  $w.init = function () {\n\t    console.log('aaa');\n\t  };\n\t  return $w;\n\t}();\n\n\twindow.Watcher = Watcher;\n\twindow.$w === undefined && (window.$w = Watcher);\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\tvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\n\tvar map = __webpack_require__(2);\n\tvar _config;\n\n\tfunction _isReportUrl(url) {\n\t  return url.indexOf(_config.reportUrl) >= 0;\n\t}\n\n\tfunction _notNullObject(obj) {\n\t  if ((typeof obj === \"undefined\" ? \"undefined\" : _typeof(obj)) !== \"object\") return false;\n\t  if (obj === null) return false;\n\t  return true;\n\t}\n\n\tfunction _isEmptyObject(obj) {\n\t  var name;\n\t  for (name in obj) {\n\t    return false;\n\t  }return true;\n\t}\n\n\tfunction _JSONStringifySafty(obj) {\n\t  if (!_notNullObject(obj)) return \"\";\n\t  if (_isEmptyObject(obj)) return \"\";\n\t  try {\n\t    return JSON.stringify(obj);\n\t  } catch (e) {\n\t    console.warn(\"illegal json object,can't JSON.stringify\");\n\t    return \"\";\n\t  }\n\t}\n\n\tfunction _JSONParseSafty(str) {\n\t  try {\n\t    var val = JSON.parse(str);\n\t    if ((typeof val === \"undefined\" ? \"undefined\" : _typeof(val)) === \"object\" && val !== null) {\n\t      return val;\n\t    } else {\n\t      return {};\n\t    }\n\t  } catch (err) {\n\t    console.warn(\"illegal json string ,can't JSON.parse\");\n\t    return {};\n\t  }\n\t}\n\n\tfunction _listenXhrResponse(xhr) {\n\t  var requestUrl = xhr._http.url;\n\t  setTimeout(function () {\n\t    if (xhr.readyState !== xhr.DONE) {\n\t      _errorReport({\n\t        type: \"__XHR__\",\n\t        url: requestUrl,\n\t        message: \"slow-response\"\n\t      });\n\t    }\n\t  }, 3000);\n\n\t  xhr.addEventListener(\"load\", function () {\n\t    var res = {};\n\t    if (xhr.response) {\n\t      res = _JSONParseSafty(xhr.response);\n\t    }\n\n\t    if (res && res.status && res.status.code !== 0 && res.status.status_code != 0) {\n\t      _errorReport({\n\t        type: \"__XHR__\",\n\t        url: requestUrl,\n\t        message: \"response-unexpect\",\n\t        detail: {\n\t          status: _JSONStringifySafty(res.status)\n\t        }\n\t      });\n\t    }\n\t  });\n\n\t  xhr.addEventListener(\"error\", function (e) {\n\t    _errorReport({\n\t      type: \"__XHR__\",\n\t      url: requestUrl,\n\t      message: \"response-error\"\n\t    });\n\t  });\n\t  xhr.addEventListener(\"abort\", function () {\n\t    _errorReport({\n\t      type: \"__XHR__\",\n\t      url: requestUrl,\n\t      message: \"response-abort\"\n\t    });\n\t  });\n\t  xhr.addEventListener(\"timeout\", function () {\n\t    _errorReport({\n\t      type: \"__XHR__\",\n\t      url: requestUrl,\n\t      message: \"response-timeout\"\n\t    });\n\t  });\n\t}\n\n\tfunction _get(url, callback) {\n\t  var xhr = new XMLHttpRequest();\n\t  xhr.onload = function (res) {\n\t    callback && callback(xhr);\n\t  };\n\t  xhr.open(\"GET\", url, true);\n\t  xhr.send();\n\t}\n\n\tfunction _post(options) {\n\t  var xhr = new XMLHttpRequest();\n\t  xhr.onload = function () {\n\t    if (this.status >= 200 && this.status < 300 || xhr.status == 304) {\n\t      try {\n\t        options.callback && options.callback(_JSONParseSafty(this.response));\n\t      } catch (e) {}\n\t    }\n\t  };\n\t  xhr.open(\"POST\", options.url, true);\n\t  xhr.withCredentials = true;\n\t  xhr.setRequestHeader(\"Content-Type\", \"application/x-www-form-urlencoded\");\n\t  xhr.setRequestHeader(\"Accept\", \"application/json, text/plain, */*\");\n\t  xhr.send(_JSONStringifySafty(options.data));\n\t}\n\n\tfunction _handleError(evt) {\n\t  var error = evt.error;\n\t  if (!error) {\n\t    console.warn(\"Mark crossorigin on script tag to get detailed error message\");\n\t    return null;\n\t  }\n\t  return {\n\t    message: error.message,\n\t    url: evt.filename,\n\t    type: \"__WINDOW_ERROR__\",\n\t    detail: {\n\t      stack: error.stack,\n\t      lineno: evt.lineno,\n\t      colno: evt.colno\n\t    }\n\t  };\n\t}\n\n\tfunction _errorReport(error) {\n\t  error.env = {\n\t    appCodeName: navigator.appCodeName,\n\t    appName: navigator.appName,\n\t    platform: navigator.platform,\n\t    appVersion: navigator.appVersion,\n\t    ua: navigator.userAgent\n\t  };\n\t  _post({\n\t    url: _config.reportUrl,\n\t    data: error\n\t  });\n\t}\n\n\tfunction _watchXhrError() {\n\t  var xhrProto = XMLHttpRequest.prototype;\n\t  xhrProto._open = xhrProto.open;\n\t  xhrProto.open = function (method, url) {\n\t    this._http = this._http || {};\n\t    this._http.method = method;\n\t    this._http.url = url;\n\t    return xhrProto._open.apply(this, [].slice.call(arguments));\n\t  };\n\t  xhrProto._send = xhrProto.send;\n\t  xhrProto.send = function () {\n\t    var xhr = this;\n\t    if (!_isReportUrl(xhr._http.url)) {\n\t      _listenXhrResponse(xhr);\n\t    }\n\t    return xhrProto._send.apply(this, [].slice.call(arguments));\n\t  };\n\t}\n\n\tfunction _watchWinError() {\n\t  window.addEventListener(\"error\", function (evt) {\n\t    var line = evt.lineno;\n\t    var col = evt.colno;\n\t    var stack = evt.error.stack;\n\n\t    var error = _handleError(evt);\n\t    if (error) {\n\t      _errorReport(error);\n\t    }\n\t  });\n\t}\n\n\tfunction _watcherInit(config) {\n\t  _config = config;\n\t  _watchWinError();\n\t  _watchXhrError();\n\t}\n\n\tmodule.exports = {\n\t  watcherInit: _watcherInit,\n\t  watchWinError: _watchWinError,\n\t  watchXhrError: _watchXhrError\n\t};\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports) {\n\n\t\n\n\tfunction _decodeSourceMap(sourceMap) {\n\t  var mappings = sourceMap.mappings;\n\n\t  var uglyLineArr = mappings.split(\";\");\n\t  uglyLineArr = uglyLineArr.map(function (line) {\n\t    var keywordArr = line.split(\",\");\n\t    return keywordArr;\n\t  });\n\t  uglyLineArr = uglyLineArr.map(function (keywordArr) {\n\t    return keywordArr.map(function (keyword) {\n\t      return decode(keyword);\n\t    });\n\t  });\n\n\t  fixedMap = getAbsoultePosition(uglyLineArr);\n\n\t  return fixedMap;\n\t}\n\n\tfunction getAbsoultePosition(uglyLineArr) {\n\t  var sourceFileIndex = 0,\n\t      sourceCodeLine = 0,\n\t      sourceCodeColumn = 0,\n\t      nameIndex = 0;\n\n\t  var fixedMap = uglyLineArr.map(function (keywordArr) {\n\t    var generatedCodeColumn = 0;\n\n\t    return keywordArr.map(function (keyword) {\n\t      var absoluteKeyword = [];\n\t      generatedCodeColumn += keyword[0];\n\t      absoluteKeyword.push(generatedCodeColumn);\n\n\t      sourceFileIndex += keyword[1];\n\t      sourceCodeLine += keyword[2];\n\t      sourceCodeColumn += keyword[3];\n\n\t      absoluteKeyword.push(sourceFileIndex, sourceCodeLine, sourceCodeColumn);\n\n\t      if (keyword[4] !== undefined) {\n\t        nameIndex += keyword[4];\n\t        absoluteKeyword.push(nameIndex);\n\t      }\n\n\t      return absoluteKeyword;\n\t    });\n\t  });\n\n\t  return fixedMap;\n\t}\n\n\tfunction _fixPosDetail(line, col, map, names, sources) {\n\t  var colIndexInMap = col - 1;\n\n\t  var lineMap = map[line - 1];\n\t  var keywordMap = void 0;\n\t  lineMap.some(function (keyword) {\n\t    if (keyword[0] === col - 1) {\n\t      keywordMap = keyword;\n\t      return true;\n\t    }\n\t    return false;\n\t  });\n\n\t  var sourceCodeLine = keywordMap[2] + 1;\n\t  var sourceCodeColumn = keywordMap[3] + 1;\n\t  var sourceFile = sources[keywordMap[1]];\n\n\t  var sourceName = \"\";\n\t  if (keywordMap[4] !== undefined) {\n\t    sourceName = names[keywordMap[4]];\n\t  }\n\n\t  return {\n\t    sourceCodeLine: sourceCodeLine,\n\t    sourceCodeColumn: sourceCodeColumn,\n\t    sourceFile: sourceFile,\n\t    sourceName: sourceName\n\t  };\n\t}\n\n\tmodule.exports = {\n\t  decodeSourceMap: _decodeSourceMap,\n\t  fixPosDetail: _fixPosDetail\n\t};\n\n/***/ })\n/******/ ]);"]}